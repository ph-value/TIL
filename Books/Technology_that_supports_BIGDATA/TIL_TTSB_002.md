
# 빅데이터를 지탱하는 기술

### 일자
2023.08.19.토

### CHAPTER 2 빅데이터의 탐색

### 책에서 기억하고 싶은 내용
#### 크로스 집계
- 크로스 테이블
  - 행과 열이 교차하는 부분에 숫자 데이터가 들어감.
  - 
|   | 2017년 1월  | 2017년 2월  |  2017년 3월 |
|---|---|---|---|
| 상품 A  | 51,500  |  57,500 | 60,000  |
| 상품 B  |  24,000 | 5,800  | 12,400  |

- 트랜잭션 테이블 
  - 우리가 익히 하는 데이터 베이스에서의 테이블 형식.
  - 행 방향으로 데이터가 증가하게 하고, 열 방향으로는 증가시키지 않도록 해야한다.

- 크로스 집계 (Cross Tabulation)
  - 트랜잭션 테이블 -> 크로스 테이블 변환하는 과정.

- 테이블의 종횡변환 💬
> 엑셀 또는 BI 도구에 의존하지 않고, 어떻게든 SQL로 크로스 집계하고 싶을 때도 있다.
> 예를 들어, 크로스 테이블을 중간 테이블에 기록하고 싶다든지, ... (52p/E80p)

---
#### 데이터 집계를 위한 데이터 베이스의 구조
> 시스템 구성은 데이터 마트의 크기에 따라 결정된다.
> ...
> '데이터 마트의 크기'에 따라 시스템 구성이 결정된다.
- 3계층의 데이터 집계 시스템
  ```mermaid
  graph LR;
  A[데이터 레이크] --> B[데이터 마트] --> C[시각화 도구] 
  ```
  - 데이터 레이크 -> 데이터 마트의 단계는 **데이터 집계**과정이고 수분에서 수시간이 소요,
  - 데이터 마트 -> 시각화 도구의 단계는 **크로스 집계** 과정이고 수초만에 진행되어야 한다.

- '압축'과 '분산'에 의해 지연 줄이기
  - 데이터를 가능한 한 작게 압축하고, 그거을 여러 디스크에 분산하여 데이터의 로드 지연을 줄인다.


- **MPP 기술 (massive parallel processing: 대규모 병렬 처리)**
  - EX) `Amazon Redshift` 및 `Google Bigquery`
  - MPP는 데이터의 집계에 최적화.
  - 데이터 웨어하우스와 데이터 분석용의 데이터베이스에서 특히 많이 사용.
  > MPP에서는 하나의 쿼리를 다수의 작은 태스크로 분해하고 이를 가능한 한 병렬로 실행한다.
  > 예를 들어, 1억 레코드로 이루어진 테이블의 함계(sum())를 계산하기 위해 그것을 10만 레코드로 구분하여 1,000개의 태스크로 나누는 것이다. 
  > 각 태스크를 각각 독립적으로 10만레코드의 합계를 집계해 마지막 모든 결과를 모아 총합계를 계한한다.
  
- 열 지향 데이터베이스(column-oriented database)
  - 컬럼을 압축하여 디스크 I/O를 줄이기
  - EX) `Teradata`💬, `Amazon Redshift`
  - 필요한 컬럼만 로드하여 디스크 I/O를 줄인다

- 행 지향 데이터베이스
  - 고속화를 위해 인덱스를 만든다.
---
#### 애드 혹 분석과 시각화 도구
- '애드 혹 분석'?
  > 원하는 데이터가 어디에 있는지도 모르고,
  > 집계 시간이 얼마나 걸리는지 알지도 못하는 상황에서는 여러번의 시행착오를 반복하면서 데이터를 살펴보는 것이다.

- 대시보드 도구💬
  - Redash: SQL에 의한 쿼리의 실행 결과를 그대로 시각화
  - Superset: 화면상에서 마우스 조작만으 그래프를 그리기
  - Kibana: Elasticsearch의 프론트 엔드에서 실시간으로 작성

- BI 도구
  > 몇 개월 단위의 장기적인 데이터 추이를 시각화 하거나, 집계의 조건을 세부적으 바꿀 수 있는 대시보드를 만들려면, BI 도구를 사용하는 것이 적합하다.
---
#### 데이터 마트의 기본 구조
- 시각화에 적합한 데이터 마트 만들기 - **OLAP** (Online analytical processing)
  - 데이터베이스의 설계에서
    - 트랜잭션: 시간과 함께 생성되는 데이터를 기록한 것
    - 마스터: 트랜잭션에 참고되는 각종 정보
  - 데이터 웨어하우의 세계에서
    - 팩트 테이블: 트랜잭션처럼 사실이 기록 된 것
    - 디멘전 테이블: 참고되는 마스터 데이터, 데이터를 분류하기 위한 속성값으 사용된다.
  - 스타 스키마와 비정규화
    - 팩트 테이블을 중심으로 여러 디멘전 테이블을 결합
    - 데이터 마트를 만들 때는 팩트 테이블을 중심으로 여러 디멘전 테이블을 결합하는 것이 좋다. -> 별 모양이 되므로, 스타 스키마라고 부른다.
  - 스타 스키마의 장점 
    - 단순해서 이해하기 쉽고, 데이터 분석을 쉽게 할 수 있다는 점이 있다.
    - SQL로 결합하는 경우는 JOIN을 사용
    - 성능상으로, 팩트 테이블을 될 수 있는 한 작게 하는 것이 고속화에 있어서 중요.
      - 팩트 테이블에는 ID와 같은 키만을 남겨두고 그 외의 나머지는 디멘전 테이블로 옮긴다. 
  - **다차원 모델(multidimensional model)**
    - BI 도구의 기본이 되는 데이터 모델
    - 디멘젼(dimension)과 측정값(measure)로 분류
  - 모델의 정의 확장
    1. 시각화하고 싶은 측정값 및 디멘전을 결정.
    2. 데이터 마트에 비정규화 테이블 생성, BI도구로 시각화.
    3. 시각화 중 새로운 집계방식 필요성 시 컬럼 추가 및 집계. -> 새 그래프 생성
    - 요구에 따라 다차원 모델의 정의는 확장할 수 있다. 
- **브레이크 다운 분석(breakdown analysis)** 💬
  > BI 도구에서 데이터를 볼 때 어떤 숫자가 어디에서 오는 것인지 그 내역을 파악하고 싶을 때가 많다. (85p/E113p)
  

### 읽은 내용에 대한 내 생각
- MPP의 개념에 대해 좀 더 공부해야겠다.
- '열 지향 스토리지✕MPP에 의한 고속화와 주의점'(63p/E91p)을 읽고 과도한 부하를 유발하는 쿼리를 작성하지 않도록 노력해야겠다는 생각.
  - 물론 이러한 쿼리를 작성할 때에도 그런 결과를 불러올지 모를 수 있지만...

---
> 시각화에 적합한 데이터 마트를 만드는 것 -> 'BI 도구를 위한 비정규화 테이블을 만드는' 프로세스
  - 비정규화를 해야한다???? 평생 정규화를 위해 살았다구요;;;;
  - 뇌를 유연하게 사용할 수 있게 해야 한다 ! ! !
  - 맥<->윈도우, 여러 IDE 동시 사용 등 말단 신경을 이용한 변환은 잘 하는데, 머릿속에서 잘 왔다갔다 할지는 모르겠다. 
- 2-4 섹션이 정말 어렵게 느껴졌다. 예시가 거의 없고 추상적인 내용을 담고 있어서 그런 것 같다. 아니 반복해서 읽어봐야겠다.

### 💬 기타 메모 (TBU)
#### 테이블의 종횡변환 예시 조사
#### `Teradata`에 대하여 조사
#### 대시보드 도구 3가지 조사
#### '브레이크 다운 분석' 방법 혹은 예시 조사
